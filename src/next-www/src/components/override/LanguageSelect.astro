---
import context from 'virtual:starlight/project-context';
import config from 'virtual:starlight/user-config';
import { localizedUrl } from '../../utils/localizedUrl';

/**
 * Get the equivalent of the current page path for the passed locale.
 */
function localizedPathname(locale: string | undefined): string {
    return localizedUrl(Astro.url, locale, context.trailingSlash).pathname;
}

const locale = Astro.locals.starlightRoute.locale
const title = locale==='en'?'English':'简体中文'

---
<span style="width: 80px;text-align: center">{title}</span>
<div id="languageSwatchButton" style="display: flex;justify-content: center;"
        data-current-locale={locale}
        data-en-path={localizedPathname('en')}
        data-zh-path={localizedPathname('zh-cn')}
>

        <svg  viewBox="0 0 1024 1024"  xmlns="http://www.w3.org/2000/svg" p-id="4719" width="20" height="20"><path d="M670.72 325.696L511.552 152l87.68-87.872 360.96 389.504L832 453.76v0.64H64V325.76h606.72z m-318.4 382.08l157.248 172.8-94.976 79.552L63.872 579.84l147.712-0.704v-0.128H960v128.768H352.32z" fill="var(--color-foreground)" p-id="4720"></path></svg>
</div>

<style>

</style>

<script is:inline>
    function handleLanguageSwitch() {
        const currentLocale = this.dataset.currentLocale
        const newLocale = currentLocale === 'en' ? 'zh-cn' : 'en';
        const newPath = currentLocale === 'en'
            ? this.dataset.zhPath
            : this.dataset.enPath;
        
        if (newPath) {
            // 保存用户的语言偏好到 Cookie（有效期 1 年）
            const expires = new Date();
            expires.setFullYear(expires.getFullYear() + 1);
            document.cookie = `preferred-locale=${newLocale}; path=/; expires=${expires.toUTCString()}; SameSite=Lax`;
            
            console.log('[Language Switch] Saved locale to cookie:', newLocale);
            window.location.pathname = newPath;
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('languageSwatchButton')
        if (btn) {
            btn.addEventListener('click', handleLanguageSwitch)
        }
    });
</script>